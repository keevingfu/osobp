<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEAP KPI指标字典与看板配置脚本</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.8;
            color: #333;
            background: #f5f7fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.9;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
            flex: 1;
            text-align: center;
        }
        
        .nav-tab:hover {
            color: #667eea;
            background: #f8f9ff;
        }
        
        .nav-tab.active {
            color: #667eea;
            background: #f8f9ff;
            font-weight: 600;
            border-bottom: 3px solid #667eea;
        }
        
        /* Content Sections */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Cards */
        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section h3 {
            color: #333;
            margin: 25px 0 15px;
        }
        
        .section h4 {
            color: #666;
            margin: 20px 0 10px;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .kpi-card {
            background: #f8f9ff;
            border: 2px solid #e0e7ff;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .kpi-name {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }
        
        .kpi-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            background: #667eea;
            color: white;
        }
        
        .kpi-formula {
            background: #1a1a2e;
            color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        /* Tables */
        .kpi-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .kpi-table th,
        .kpi-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }
        
        .kpi-table th {
            background: #f8f9ff;
            font-weight: 600;
            color: #667eea;
        }
        
        .kpi-table tr:hover {
            background: #fafafa;
        }
        
        /* Code Blocks */
        .code-block {
            background: #1a1a2e;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
        }
        
        .code-comment {
            color: #6c757d;
        }
        
        .code-keyword {
            color: #bd93f9;
        }
        
        .code-string {
            color: #f1fa8c;
        }
        
        .code-number {
            color: #50fa7b;
        }
        
        .code-function {
            color: #8be9fd;
        }
        
        /* Status Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }
        
        .badge-primary { background: #667eea; color: white; }
        .badge-success { background: #4caf50; color: white; }
        .badge-warning { background: #ffc107; color: #333; }
        .badge-danger { background: #f44336; color: white; }
        .badge-info { background: #2196f3; color: white; }
        
        /* Dashboard Preview */
        .dashboard-preview {
            background: #f5f6fa;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .metric-box {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            display: inline-block;
            min-width: 200px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 14px;
            color: #666;
        }
        
        .metric-change {
            font-size: 14px;
            margin-top: 5px;
        }
        
        .positive { color: #4caf50; }
        .negative { color: #f44336; }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #5a67d8;
        }
        
        /* Formula Box */
        .formula-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        /* Warning Box */
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                font-size: 14px;
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>LEAP KPI指标字典与看板配置</h1>
            <p>全搜索优化增长平台核心指标体系 V1.0</p>
            <p style="font-size: 14px; margin-top: 10px;">更新日期：2025年7月24日</p>
        </div>
    </div>

    <div class="container">
        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('overview')">指标概览</button>
            <button class="nav-tab" onclick="showSection('dictionary')">KPI字典</button>
            <button class="nav-tab" onclick="showSection('formulas')">计算公式</button>
            <button class="nav-tab" onclick="showSection('dashboard')">看板配置</button>
            <button class="nav-tab" onclick="showSection('scripts')">部署脚本</button>
            <button class="nav-tab" onclick="showSection('monitoring')">监控告警</button>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <div class="section">
                <h2>KPI指标体系概览</h2>
                
                <h3>1.1 指标体系架构</h3>
                <div class="dashboard-preview">
                    <h4>LEAP平台核心KPI体系</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div class="metric-box" style="text-align: left; padding: 20px;">
                            <div class="metric-label" style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">AI可见度指标（6个）</div>
                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                <li>• AI Mention Rate - AI提及率</li>
                                <li>• SoV-AI - AI回答占有率</li>
                                <li>• Brand Citation Score - 品牌引用分</li>
                                <li>• Platform Coverage - 平台覆盖率</li>
                                <li>• Competitor Gap Score - 竞品差距分</li>
                                <li>• Content Freshness Index - 内容新鲜度</li>
                            </ul>
                        </div>
                        <div class="metric-box" style="text-align: left; padding: 20px;">
                            <div class="metric-label" style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">转化漏斗指标（8个）</div>
                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                <li>• Answer→Owned CTR - AI到自有点击率</li>
                                <li>• Opt-in Rate - 线索转化率</li>
                                <li>• CPL_AI - AI渠道线索成本</li>
                                <li>• FMA Rate - 首次关键行为率</li>
                                <li>• Landing Page Quality - 着陆页质量分</li>
                                <li>• Multi-touch Attribution - 多触点归因率</li>
                                <li>• Conversion Velocity - 转化速度</li>
                                <li>• Lead Quality Score - 线索质量评分</li>
                            </ul>
                        </div>
                        <div class="metric-box" style="text-align: left; padding: 20px;">
                            <div class="metric-label" style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">内容运营指标（6个）</div>
                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                <li>• Content Production Rate - 内容产出率</li>
                                <li>• Schema Coverage - Schema覆盖度</li>
                                <li>• FAQ Completion Rate - FAQ完整度</li>
                                <li>• Video Segment Efficiency - 视频切片效率</li>
                                <li>• Content Approval Time - 内容审核时效</li>
                                <li>• Multi-modal Asset Ratio - 多模态资产占比</li>
                            </ul>
                        </div>
                        <div class="metric-box" style="text-align: left; padding: 20px;">
                            <div class="metric-label" style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">私域运营指标（10个）</div>
                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                <li>• 30-Day Retention - 30天留存率</li>
                                <li>• LTV/CAC Ratio - 价值成本比</li>
                                <li>• Content Reuse Ratio - 内容回流率</li>
                                <li>• Engagement Score - 用户互动分</li>
                                <li>• Push Open Rate - 推送打开率</li>
                                <li>• Community Activity - 社群活跃度</li>
                                <li>• Referral Rate - 推荐转化率</li>
                                <li>• NPS Score - 净推荐值</li>
                                <li>• Repeat Purchase - 复购率</li>
                                <li>• User Lifetime Value - 用户生命价值</li>
                            </ul>
                        </div>
                        <div class="metric-box" style="text-align: left; padding: 20px;">
                            <div class="metric-label" style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">技术性能指标（5个）</div>
                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                <li>• System Availability - 系统可用性</li>
                                <li>• API Response Time P95 - API响应时间</li>
                                <li>• Page Load Speed - 页面加载速度</li>
                                <li>• Error Rate - 错误率</li>
                                <li>• Data Processing Latency - 数据延迟</li>
                            </ul>
                        </div>
                        <div class="metric-box" style="text-align: left; padding: 20px;">
                            <div class="metric-label" style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">智能体效率指标（4个）</div>
                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                <li>• Agent Task Success Rate - 任务成功率</li>
                                <li>• Automation Coverage - 自动化覆盖率</li>
                                <li>• Agent Response Time - 智能体响应时间</li>
                                <li>• Human Intervention Rate - 人工干预率</li>
                            </ul>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                        <strong style="color: #667eea; font-size: 18px;">总计：39个核心KPI指标</strong>
                        <p style="margin-top: 5px; color: #666; font-size: 14px;">覆盖从AI可见度到私域转化的完整增长链路，支撑LEAP平台的全方位数据驱动决策</p>
                    </div>
                </div>
                
                <h3>1.2 指标分级体系</h3>
                <table class="kpi-table">
                    <thead>
                        <tr>
                            <th>指标级别</th>
                            <th>定义</th>
                            <th>更新频率</th>
                            <th>责任部门</th>
                            <th>示例指标</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-danger">L1-战略级</span></td>
                            <td>公司战略目标直接相关</td>
                            <td>每日更新</td>
                            <td>高管团队</td>
                            <td>AI Mention Rate、总体ROI</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">L2-业务级</span></td>
                            <td>部门业务目标</td>
                            <td>每日/每周</td>
                            <td>业务部门</td>
                            <td>转化率、获客成本</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">L3-运营级</span></td>
                            <td>日常运营管理</td>
                            <td>实时/每日</td>
                            <td>运营团队</td>
                            <td>内容发布量、用户活跃度</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-success">L4-技术级</span></td>
                            <td>系统性能监控</td>
                            <td>实时监控</td>
                            <td>技术团队</td>
                            <td>API响应时间、系统可用性</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>1.3 核心目标设定</h3>
                <div class="formula-box">
                    <h4>90天目标（MVP阶段）</h4>
                    <ul>
                        <li>AI Mention Rate ≥ 35%</li>
                        <li>SoV-AI (Share of Voice) ≥ 20%</li>
                        <li>Answer→Owned CTR ≥ 8%</li>
                        <li>Opt-in Rate ≥ 25%</li>
                        <li>CPL_AI 降低 ≥ 30%</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- KPI Dictionary Section -->
        <div id="dictionary" class="content-section">
            <div class="section">
                <h2>完整KPI指标字典</h2>
                
                <h3>2.1 AI可见度指标</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">AI Mention Rate</span>
                            <span class="kpi-category">L1-战略级</span>
                        </div>
                        <p><strong>定义：</strong>品牌在目标问题集中被AI提及的比例</p>
                        <div class="kpi-formula">
                            提及率 = (品牌被提及的问题数 / 监测问题总数) × 100%
                        </div>
                        <p><strong>数据源：</strong>AI平台API（ChatGPT、Perplexity等）</p>
                        <p><strong>更新频率：</strong>每6小时</p>
                        <p><strong>目标值：</strong>≥35%（90天）</p>
                        <p><strong>负责团队：</strong>内容运营部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">SoV-AI</span>
                            <span class="kpi-category">L1-战略级</span>
                        </div>
                        <p><strong>定义：</strong>AI回答中品牌内容占比（Answer Share of Voice）</p>
                        <div class="kpi-formula">
                            SoV-AI = (品牌内容字数 / 总回答字数) × 100%
                        </div>
                        <p><strong>数据源：</strong>AI回答内容分析</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥20%</p>
                        <p><strong>负责团队：</strong>策略分析部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Brand Citation Score</span>
                            <span class="kpi-category">L2-业务级</span>
                        </div>
                        <p><strong>定义：</strong>品牌内容被AI引用的质量分数</p>
                        <div class="kpi-formula">
                            引用分 = Σ(引用位置权重 × 引用长度) / 总引用次数
                        </div>
                        <p><strong>数据源：</strong>引用分析系统</p>
                        <p><strong>更新频率：</strong>每周</p>
                        <p><strong>目标值：</strong>≥7.5/10</p>
                        <p><strong>负责团队：</strong>内容质量部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Platform Coverage</span>
                            <span class="kpi-category">L2-业务级</span>
                        </div>
                        <p><strong>定义：</strong>品牌在各AI平台的覆盖率</p>
                        <div class="kpi-formula">
                            覆盖率 = (有品牌展示的平台数 / 目标平台总数) × 100%
                        </div>
                        <p><strong>数据源：</strong>多平台监控系统</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥80%</p>
                        <p><strong>负责团队：</strong>渠道运营部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Competitor Gap Score</span>
                            <span class="kpi-category">L2-业务级</span>
                        </div>
                        <p><strong>定义：</strong>与竞品的AI可见度差距</p>
                        <div class="kpi-formula">
                            差距分 = 我方AI Mention Rate - 竞品平均Mention Rate
                        </div>
                        <p><strong>数据源：</strong>竞品监控系统</p>
                        <p><strong>更新频率：</strong>每周</p>
                        <p><strong>目标值：</strong>≥+10%</p>
                        <p><strong>负责团队：</strong>市场情报部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Content Freshness Index</span>
                            <span class="kpi-category">L3-运营级</span>
                        </div>
                        <p><strong>定义：</strong>AI引用内容的时效性指数</p>
                        <div class="kpi-formula">
                            新鲜度 = Σ(内容权重 × e^(-天数/30)) / 总内容数
                        </div>
                        <p><strong>数据源：</strong>内容管理系统</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥0.75</p>
                        <p><strong>负责团队：</strong>内容更新组</p>
                    </div>
                </div>
                
                <h3>2.2 转化漏斗指标</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Answer→Owned CTR</span>
                            <span class="kpi-category">L1-战略级</span>
                        </div>
                        <p><strong>定义：</strong>从AI回答点击到自有资产的点击率</p>
                        <div class="kpi-formula">
                            CTR = (点击到自有资产次数 / AI回答曝光次数) × 100%
                        </div>
                        <p><strong>数据源：</strong>点击追踪系统</p>
                        <p><strong>更新频率：</strong>实时</p>
                        <p><strong>目标值：</strong>≥8%</p>
                        <p><strong>负责团队：</strong>流量运营部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Opt-in Rate</span>
                            <span class="kpi-category">L1-战略级</span>
                        </div>
                        <p><strong>定义：</strong>访客转化为私域线索的比例</p>
                        <div class="kpi-formula">
                            转化率 = (获得联系方式数 / AI来源访问数) × 100%
                        </div>
                        <p><strong>数据源：</strong>CRM系统</p>
                        <p><strong>更新频率：</strong>每小时</p>
                        <p><strong>目标值：</strong>≥25%</p>
                        <p><strong>负责团队：</strong>转化优化部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">CPL_AI</span>
                            <span class="kpi-category">L1-战略级</span>
                        </div>
                        <p><strong>定义：</strong>AI渠道的单个线索成本</p>
                        <div class="kpi-formula">
                            CPL = AI渠道总成本 / AI渠道线索数
                        </div>
                        <p><strong>数据源：</strong>财务系统 + CRM</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≤现有CPL的70%</p>
                        <p><strong>负责团队：</strong>增长营销部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">FMA Rate</span>
                            <span class="kpi-category">L2-业务级</span>
                        </div>
                        <p><strong>定义：</strong>首次关键行为率（First Meaningful Action）</p>
                        <div class="kpi-formula">
                            FMA = (7天内完成关键行为数 / 新增私域用户数) × 100%
                        </div>
                        <p><strong>数据源：</strong>用户行为系统</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥15%</p>
                        <p><strong>负责团队：</strong>用户激活组</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Landing Page Quality Score</span>
                            <span class="kpi-category">L3-运营级</span>
                        </div>
                        <p><strong>定义：</strong>承接页质量综合评分</p>
                        <div class="kpi-formula">
                            质量分 = 0.4×停留时间 + 0.3×互动率 + 0.3×转化率
                        </div>
                        <p><strong>数据源：</strong>Google Analytics</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥8/10</p>
                        <p><strong>负责团队：</strong>页面优化组</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Multi-touch Attribution Rate</span>
                            <span class="kpi-category">L3-运营级</span>
                        </div>
                        <p><strong>定义：</strong>多触点归因转化率</p>
                        <div class="kpi-formula">
                            归因率 = Σ(触点权重 × 转化贡献) / 总转化数
                        </div>
                        <p><strong>数据源：</strong>归因分析系统</p>
                        <p><strong>更新频率：</strong>每周</p>
                        <p><strong>目标值：</strong>明确归因≥80%</p>
                        <p><strong>负责团队：</strong>数据分析部</p>
                    </div>
                </div>
                
                <h3>2.3 私域运营指标</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">30-Day Retention Rate</span>
                            <span class="kpi-category">L2-业务级</span>
                        </div>
                        <p><strong>定义：</strong>30天用户留存率</p>
                        <div class="kpi-formula">
                            留存率 = (30天后仍活跃用户数 / 新增用户数) × 100%
                        </div>
                        <p><strong>数据源：</strong>用户行为数据库</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥30%</p>
                        <p><strong>负责团队：</strong>用户运营部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">LTV/CAC Ratio</span>
                            <span class="kpi-category">L1-战略级</span>
                        </div>
                        <p><strong>定义：</strong>用户生命周期价值与获客成本比</p>
                        <div class="kpi-formula">
                            比率 = 平均用户生命周期价值 / 平均获客成本
                        </div>
                        <p><strong>数据源：</strong>财务系统 + CRM</p>
                        <p><strong>更新频率：</strong>每月</p>
                        <p><strong>目标值：</strong>≥3.0</p>
                        <p><strong>负责团队：</strong>增长战略部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Content Reuse Ratio</span>
                            <span class="kpi-category">L2-业务级</span>
                        </div>
                        <p><strong>定义：</strong>UGC内容回流利用率</p>
                        <div class="kpi-formula">
                            回流率 = (用于GEO的UGC内容数 / 总UGC内容数) × 100%
                        </div>
                        <p><strong>数据源：</strong>内容管理系统</p>
                        <p><strong>更新频率：</strong>每周</p>
                        <p><strong>目标值：</strong>≥40%</p>
                        <p><strong>负责团队：</strong>内容运营部</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">Engagement Score</span>
                            <span class="kpi-category">L3-运营级</span>
                        </div>
                        <p><strong>定义：</strong>私域用户互动综合评分</p>
                        <div class="kpi-formula">
                            互动分 = 0.3×打开率 + 0.3×点击率 + 0.4×转化率
                        </div>
                        <p><strong>数据源：</strong>私域运营平台</p>
                        <p><strong>更新频率：</strong>每日</p>
                        <p><strong>目标值：</strong>≥7/10</p>
                        <p><strong>负责团队：</strong>私域运营组</p>
                    </div>
                </div>
                
                <h3>2.4 技术性能指标</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">System Availability</span>
                            <span class="kpi-category">L4-技术级</span>
                        </div>
                        <p><strong>定义：</strong>系统可用性</p>
                        <div class="kpi-formula">
                            可用性 = (总时间 - 故障时间) / 总时间 × 100%
                        </div>
                        <p><strong>数据源：</strong>监控系统</p>
                        <p><strong>更新频率：</strong>实时</p>
                        <p><strong>目标值：</strong>≥99.95%</p>
                        <p><strong>负责团队：</strong>SRE团队</p>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-name">API Response Time P95</span>
                            <span class="kpi-category">L4-技术级</span>
                        </div>
                        <p><strong>定义：</strong>API响应时间95分位</p>
                        <div class="kpi-formula">
                            P95 = 95%请求的响应时间阈值
                        </div>
                        <p><strong>数据源：</strong>APM系统</p>
                        <p><strong>更新频率：</strong>实时</p>
                        <p><strong>目标值：</strong>≤200ms</p>
                        <p><strong>负责团队：</strong>后端开发组</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Formulas Section -->
        <div id="formulas" class="content-section">
            <div class="section">
                <h2>KPI计算公式详解</h2>
                
                <h3>3.1 基础计算公式</h3>
                <div class="formula-box">
                    <h4>漏斗转化率计算</h4>
                    <pre>总体转化率 = (最终转化数 / 初始流量) × 100%

各阶段转化率：
- 展示→点击 = (点击数 / 展示数) × 100%
- 点击→访问 = (访问数 / 点击数) × 100%
- 访问→线索 = (线索数 / 访问数) × 100%
- 线索→成交 = (成交数 / 线索数) × 100%</pre>
                </div>
                
                <div class="formula-box">
                    <h4>加权平均计算</h4>
                    <pre>加权AI可见度 = Σ(平台权重 × 平台可见度) / Σ平台权重

平台权重示例：
- ChatGPT: 0.35
- Google SGE: 0.30
- Perplexity: 0.20
- Bing Chat: 0.15</pre>
                </div>
                
                <h3>3.2 高级分析公式</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment">// JavaScript: 内容新鲜度指数计算</span>
<span class="code-keyword">function</span> <span class="code-function">calculateFreshnessIndex</span>(contents) {
    <span class="code-keyword">const</span> decayFactor = <span class="code-number">30</span>; <span class="code-comment">// 30天半衰期</span>
    <span class="code-keyword">let</span> totalScore = <span class="code-number">0</span>;
    <span class="code-keyword">let</span> totalWeight = <span class="code-number">0</span>;
    
    contents.<span class="code-function">forEach</span>(content => {
        <span class="code-keyword">const</span> daysSinceUpdate = <span class="code-function">getDaysSince</span>(content.lastUpdate);
        <span class="code-keyword">const</span> freshnessScore = Math.<span class="code-function">exp</span>(-daysSinceUpdate / decayFactor);
        <span class="code-keyword">const</span> weight = content.importance || <span class="code-number">1</span>;
        
        totalScore += freshnessScore * weight;
        totalWeight += weight;
    });
    
    <span class="code-keyword">return</span> totalWeight > <span class="code-number">0</span> ? totalScore / totalWeight : <span class="code-number">0</span>;
}

<span class="code-comment">// SQL: 多触点归因计算</span>
<span class="code-keyword">WITH</span> touchpoints <span class="code-keyword">AS</span> (
    <span class="code-keyword">SELECT</span> 
        user_id,
        touchpoint_type,
        touchpoint_time,
        <span class="code-keyword">CASE</span> touchpoint_position
            <span class="code-keyword">WHEN</span> <span class="code-string">'first'</span> <span class="code-keyword">THEN</span> <span class="code-number">0.4</span>
            <span class="code-keyword">WHEN</span> <span class="code-string">'last'</span> <span class="code-keyword">THEN</span> <span class="code-number">0.4</span>
            <span class="code-keyword">ELSE</span> <span class="code-number">0.2</span> / (total_touchpoints - <span class="code-number">2</span>)
        <span class="code-keyword">END</span> <span class="code-keyword">AS</span> attribution_weight
    <span class="code-keyword">FROM</span> user_journey
)
<span class="code-keyword">SELECT</span> 
    touchpoint_type,
    <span class="code-function">SUM</span>(attribution_weight * conversion_value) <span class="code-keyword">AS</span> attributed_value
<span class="code-keyword">FROM</span> touchpoints
<span class="code-keyword">GROUP BY</span> touchpoint_type;</pre>
                </div>
                
                <h3>3.3 预测模型公式</h3>
                <div class="formula-box">
                    <h4>AI可见度增长预测</h4>
                    <pre>预测可见度 = 基础可见度 × (1 + 增长率)^时间

其中：
- 增长率 = (内容质量系数 × 0.4) + (更新频率系数 × 0.3) + (技术优化系数 × 0.3)
- 时间单位：周

示例：
基础可见度 = 15%
增长率 = 5%/周
12周后预测 = 15% × (1.05)^12 ≈ 26.9%</pre>
                </div>
            </div>
        </div>

        <!-- Dashboard Configuration Section -->
        <div id="dashboard" class="content-section">
            <div class="section">
                <h2>看板配置脚本</h2>
                
                <h3>4.1 Grafana Dashboard配置</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment"># dashboard.json - Grafana看板配置</span>
{
  <span class="code-string">"dashboard"</span>: {
    <span class="code-string">"title"</span>: <span class="code-string">"LEAP Platform KPI Dashboard"</span>,
    <span class="code-string">"tags"</span>: [<span class="code-string">"kpi"</span>, <span class="code-string">"analytics"</span>, <span class="code-string">"leap"</span>],
    <span class="code-string">"timezone"</span>: <span class="code-string">"Asia/Shanghai"</span>,
    <span class="code-string">"refresh"</span>: <span class="code-string">"5m"</span>,
    <span class="code-string">"panels"</span>: [
      {
        <span class="code-string">"gridPos"</span>: { <span class="code-string">"h"</span>: <span class="code-number">8</span>, <span class="code-string">"w"</span>: <span class="code-number">6</span>, <span class="code-string">"x"</span>: <span class="code-number">0</span>, <span class="code-string">"y"</span>: <span class="code-number">0</span> },
        <span class="code-string">"type"</span>: <span class="code-string">"stat"</span>,
        <span class="code-string">"title"</span>: <span class="code-string">"AI Mention Rate"</span>,
        <span class="code-string">"targets"</span>: [{
          <span class="code-string">"rawQuery"</span>: <span class="code-keyword">true</span>,
          <span class="code-string">"rawSql"</span>: <span class="code-string">"SELECT avg(mention_rate) FROM ai_visibility WHERE time > now() - 6h"</span>
        }],
        <span class="code-string">"fieldConfig"</span>: {
          <span class="code-string">"defaults"</span>: {
            <span class="code-string">"unit"</span>: <span class="code-string">"percent"</span>,
            <span class="code-string">"thresholds"</span>: {
              <span class="code-string">"steps"</span>: [
                { <span class="code-string">"value"</span>: <span class="code-number">0</span>, <span class="code-string">"color"</span>: <span class="code-string">"red"</span> },
                { <span class="code-string">"value"</span>: <span class="code-number">25</span>, <span class="code-string">"color"</span>: <span class="code-string">"yellow"</span> },
                { <span class="code-string">"value"</span>: <span class="code-number">35</span>, <span class="code-string">"color"</span>: <span class="code-string">"green"</span> }
              ]
            }
          }
        }
      }
    ]
  }
}</pre>
                </div>
                
                <h3>4.2 ClickHouse数据表结构</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment">-- ClickHouse表结构定义</span>
<span class="code-keyword">CREATE TABLE</span> leap.kpi_metrics (
    event_date <span class="code-keyword">Date</span> <span class="code-keyword">DEFAULT</span> <span class="code-function">toDate</span>(event_time),
    event_time <span class="code-keyword">DateTime</span> <span class="code-keyword">DEFAULT</span> <span class="code-function">now</span>(),
    tenant_id <span class="code-keyword">String</span>,
    
    <span class="code-comment">-- AI可见度指标</span>
    ai_mention_rate <span class="code-keyword">Float32</span>,
    sov_ai <span class="code-keyword">Float32</span>,
    brand_citation_score <span class="code-keyword">Float32</span>,
    platform_coverage <span class="code-keyword">Float32</span>,
    
    <span class="code-comment">-- 转化指标</span>
    answer_to_owned_ctr <span class="code-keyword">Float32</span>,
    opt_in_rate <span class="code-keyword">Float32</span>,
    cpl_ai <span class="code-keyword">Float32</span>,
    fma_rate <span class="code-keyword">Float32</span>,
    
    <span class="code-comment">-- 私域指标</span>
    retention_30d <span class="code-keyword">Float32</span>,
    ltv_cac_ratio <span class="code-keyword">Float32</span>,
    content_reuse_ratio <span class="code-keyword">Float32</span>,
    engagement_score <span class="code-keyword">Float32</span>,
    
    <span class="code-comment">-- 技术指标</span>
    system_availability <span class="code-keyword">Float32</span>,
    api_response_p95 <span class="code-keyword">UInt32</span>,
    
    <span class="code-comment">-- 维度字段</span>
    channel <span class="code-keyword">String</span>,
    platform <span class="code-keyword">String</span>,
    content_type <span class="code-keyword">String</span>,
    campaign_id <span class="code-keyword">String</span>
) <span class="code-keyword">ENGINE</span> = MergeTree()
<span class="code-keyword">PARTITION BY</span> <span class="code-function">toYYYYMM</span>(event_date)
<span class="code-keyword">ORDER BY</span> (tenant_id, event_time)
<span class="code-keyword">TTL</span> event_date + <span class="code-keyword">INTERVAL</span> <span class="code-number">90</span> <span class="code-keyword">DAY</span>;</pre>
                </div>
                
                <h3>4.3 实时数据流配置</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment">// kafka-streams-config.js</span>
<span class="code-keyword">const</span> { KafkaStreams } = <span class="code-function">require</span>(<span class="code-string">'kafka-streams'</span>);

<span class="code-keyword">const</span> config = {
    kafka: {
        <span class="code-string">'bootstrap.servers'</span>: <span class="code-string">'kafka:9092'</span>,
        <span class="code-string">'group.id'</span>: <span class="code-string">'leap-kpi-processor'</span>,
        <span class="code-string">'enable.auto.commit'</span>: <span class="code-keyword">false</span>
    },
    topics: {
        input: <span class="code-string">'raw-events'</span>,
        output: <span class="code-string">'kpi-metrics'</span>
    }
};

<span class="code-keyword">const</span> stream = <span class="code-keyword">new</span> <span class="code-function">KafkaStreams</span>(config);

stream
    .<span class="code-function">from</span>(<span class="code-string">'raw-events'</span>)
    .<span class="code-function">mapJSONConvenience</span>()
    .<span class="code-function">window</span>(<span class="code-number">60</span>, <span class="code-number">5</span>, <span class="code-string">'event_type'</span>) <span class="code-comment">// 60秒窗口，5秒滑动</span>
    .<span class="code-function">aggregate</span>(
        () => ({
            count: <span class="code-number">0</span>,
            sum: <span class="code-number">0</span>,
            values: []
        }),
        (oldVal, event) => {
            oldVal.count++;
            oldVal.sum += event.value;
            oldVal.values.<span class="code-function">push</span>(event.value);
            <span class="code-keyword">return</span> oldVal;
        },
        (newVal) => {
            <span class="code-keyword">const</span> avg = newVal.sum / newVal.count;
            <span class="code-keyword">const</span> p95 = <span class="code-function">calculateP95</span>(newVal.values);
            <span class="code-keyword">return</span> {
                metric_type: newVal.key,
                avg_value: avg,
                p95_value: p95,
                sample_count: newVal.count,
                timestamp: <span class="code-keyword">new</span> <span class="code-function">Date</span>().<span class="code-function">toISOString</span>()
            };
        }
    )
    .<span class="code-function">to</span>(<span class="code-string">'kpi-metrics'</span>);

stream.<span class="code-function">start</span>();</pre>
                </div>
            </div>
        </div>

        <!-- Deployment Scripts Section -->
        <div id="scripts" class="content-section">
            <div class="section">
                <h2>部署脚本</h2>
                
                <h3>5.1 Docker Compose配置</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment"># docker-compose.yml</span>
<span class="code-keyword">version</span>: <span class="code-string">'3.8'</span>

<span class="code-keyword">services</span>:
  <span class="code-keyword">clickhouse</span>:
    <span class="code-keyword">image</span>: clickhouse/clickhouse-server:latest
    <span class="code-keyword">ports</span>:
      - <span class="code-string">"8123:8123"</span>
      - <span class="code-string">"9000:9000"</span>
    <span class="code-keyword">volumes</span>:
      - ./clickhouse/config.xml:/etc/clickhouse-server/config.xml
      - clickhouse-data:/var/lib/clickhouse
    <span class="code-keyword">environment</span>:
      CLICKHOUSE_DB: leap_analytics
      CLICKHOUSE_USER: ${CLICKHOUSE_USER}
      CLICKHOUSE_PASSWORD: ${CLICKHOUSE_PASSWORD}

  <span class="code-keyword">grafana</span>:
    <span class="code-keyword">image</span>: grafana/grafana:latest
    <span class="code-keyword">ports</span>:
      - <span class="code-string">"3000:3000"</span>
    <span class="code-keyword">volumes</span>:
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana/datasources:/etc/grafana/provisioning/datasources
      - grafana-data:/var/lib/grafana
    <span class="code-keyword">environment</span>:
      GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD}
      GF_INSTALL_PLUGINS: vertamedia-clickhouse-datasource

  <span class="code-keyword">redis</span>:
    <span class="code-keyword">image</span>: redis:alpine
    <span class="code-keyword">ports</span>:
      - <span class="code-string">"6379:6379"</span>
    <span class="code-keyword">command</span>: redis-server --requirepass ${REDIS_PASSWORD}
    <span class="code-keyword">volumes</span>:
      - redis-data:/data

  <span class="code-keyword">kafka</span>:
    <span class="code-keyword">image</span>: confluentinc/cp-kafka:latest
    <span class="code-keyword">depends_on</span>:
      - zookeeper
    <span class="code-keyword">ports</span>:
      - <span class="code-string">"9092:9092"</span>
    <span class="code-keyword">environment</span>:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

<span class="code-keyword">volumes</span>:
  clickhouse-data:
  grafana-data:
  redis-data:</pre>
                </div>
                
                <h3>5.2 初始化脚本</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment">#!/bin/bash</span>
<span class="code-comment"># init-kpi-system.sh</span>

<span class="code-keyword">set</span> -e

<span class="code-keyword">echo</span> <span class="code-string">"=== LEAP KPI系统初始化 ==="</span>

<span class="code-comment"># 1. 创建ClickHouse数据库和表</span>
<span class="code-keyword">echo</span> <span class="code-string">"创建ClickHouse数据库..."</span>
clickhouse-client --query <span class="code-string">"CREATE DATABASE IF NOT EXISTS leap_analytics"</span>

<span class="code-comment"># 2. 导入Grafana看板</span>
<span class="code-keyword">echo</span> <span class="code-string">"导入Grafana看板配置..."</span>
curl -X POST http://admin:${GRAFANA_PASSWORD}@localhost:3000/api/dashboards/db \
  -H <span class="code-string">"Content-Type: application/json"</span> \
  -d @grafana/dashboards/kpi-dashboard.json

<span class="code-comment"># 3. 配置Redis默认值</span>
<span class="code-keyword">echo</span> <span class="code-string">"配置Redis默认KPI阈值..."</span>
redis-cli -a ${REDIS_PASSWORD} << EOF
HSET kpi:thresholds:ai_mention_rate warning 25 danger 15
HSET kpi:thresholds:opt_in_rate warning 20 danger 15
HSET kpi:thresholds:system_availability warning 99.9 danger 99.5
EOF

<span class="code-comment"># 4. 创建定时任务</span>
<span class="code-keyword">echo</span> <span class="code-string">"配置定时任务..."</span>
(crontab -l 2>/dev/null; <span class="code-keyword">echo</span> <span class="code-string">"*/5 * * * * /opt/leap/scripts/collect-kpi-metrics.sh"</span>) | crontab -

<span class="code-keyword">echo</span> <span class="code-string">"✓ 初始化完成！"</span></pre>
                </div>
                
                <h3>5.3 数据采集脚本</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment">// collect-kpi-metrics.js</span>
<span class="code-keyword">const</span> axios = <span class="code-function">require</span>(<span class="code-string">'axios'</span>);
<span class="code-keyword">const</span> { ClickHouse } = <span class="code-function">require</span>(<span class="code-string">'clickhouse'</span>);
<span class="code-keyword">const</span> Redis = <span class="code-function">require</span>(<span class="code-string">'ioredis'</span>);

<span class="code-keyword">class</span> <span class="code-function">KPICollector</span> {
    <span class="code-function">constructor</span>() {
        <span class="code-keyword">this</span>.clickhouse = <span class="code-keyword">new</span> <span class="code-function">ClickHouse</span>({
            url: process.env.CLICKHOUSE_HOST,
            database: <span class="code-string">'leap_analytics'</span>
        });
        
        <span class="code-keyword">this</span>.redis = <span class="code-keyword">new</span> <span class="code-function">Redis</span>({
            host: process.env.REDIS_HOST,
            password: process.env.REDIS_PASSWORD
        });
        
        <span class="code-keyword">this</span>.apis = {
            chatgpt: process.env.CHATGPT_API,
            perplexity: process.env.PERPLEXITY_API,
            analytics: process.env.GA_API
        };
    }
    
    <span class="code-keyword">async</span> <span class="code-function">collectAIMentionRate</span>() {
        <span class="code-keyword">const</span> platforms = [<span class="code-string">'chatgpt'</span>, <span class="code-string">'perplexity'</span>, <span class="code-string">'gemini'</span>, <span class="code-string">'bing'</span>];
        <span class="code-keyword">const</span> results = [];
        
        <span class="code-keyword">for</span> (<span class="code-keyword">const</span> platform <span class="code-keyword">of</span> platforms) {
            <span class="code-keyword">try</span> {
                <span class="code-keyword">const</span> data = <span class="code-keyword">await</span> <span class="code-keyword">this</span>.<span class="code-function">fetchPlatformData</span>(platform);
                <span class="code-keyword">const</span> mentionRate = <span class="code-keyword">this</span>.<span class="code-function">calculateMentionRate</span>(data);
                
                results.<span class="code-function">push</span>({
                    platform,
                    mention_rate: mentionRate,
                    sample_size: data.total_queries,
                    timestamp: <span class="code-keyword">new</span> <span class="code-function">Date</span>()
                });
            } <span class="code-keyword">catch</span> (error) {
                console.<span class="code-function">error</span>(<span class="code-string">`Error collecting from ${platform}:`</span>, error);
            }
        }
        
        <span class="code-keyword">return</span> results;
    }
    
    <span class="code-keyword">async</span> <span class="code-function">saveMetrics</span>(metrics) {
        <span class="code-comment">// 批量插入ClickHouse</span>
        <span class="code-keyword">const</span> values = metrics.<span class="code-function">map</span>(m => [
            m.tenant_id,
            m.ai_mention_rate,
            m.sov_ai,
            m.answer_to_owned_ctr,
            m.opt_in_rate,
            m.platform,
            m.channel
        ]);
        
        <span class="code-keyword">await</span> <span class="code-keyword">this</span>.clickhouse.<span class="code-function">insert</span>(
            <span class="code-string">'INSERT INTO kpi_metrics (tenant_id, ai_mention_rate, sov_ai, answer_to_owned_ctr, opt_in_rate, platform, channel) VALUES'</span>,
            values
        ).<span class="code-function">toPromise</span>();
        
        <span class="code-comment">// 更新Redis缓存</span>
        <span class="code-keyword">for</span> (<span class="code-keyword">const</span> metric <span class="code-keyword">of</span> metrics) {
            <span class="code-keyword">await</span> <span class="code-keyword">this</span>.redis.<span class="code-function">hset</span>(
                <span class="code-string">`kpi:current:${metric.tenant_id}`</span>,
                <span class="code-string">'ai_mention_rate'</span>,
                metric.ai_mention_rate
            );
        }
    }
    
    <span class="code-keyword">async</span> <span class="code-function">run</span>() {
        console.<span class="code-function">log</span>(<span class="code-string">'Starting KPI collection...'</span>);
        
        <span class="code-keyword">const</span> mentionData = <span class="code-keyword">await</span> <span class="code-keyword">this</span>.<span class="code-function">collectAIMentionRate</span>();
        <span class="code-keyword">const</span> conversionData = <span class="code-keyword">await</span> <span class="code-keyword">this</span>.<span class="code-function">collectConversionMetrics</span>();
        <span class="code-keyword">const</span> performanceData = <span class="code-keyword">await</span> <span class="code-keyword">this</span>.<span class="code-function">collectPerformanceMetrics</span>();
        
        <span class="code-keyword">const</span> allMetrics = [
            ...mentionData,
            ...conversionData,
            ...performanceData
        ];
        
        <span class="code-keyword">await</span> <span class="code-keyword">this</span>.<span class="code-function">saveMetrics</span>(allMetrics);
        
        console.<span class="code-function">log</span>(<span class="code-string">`✓ Collected ${allMetrics.length} metrics`</span>);
    }
}

<span class="code-comment">// 运行采集器</span>
<span class="code-keyword">const</span> collector = <span class="code-keyword">new</span> <span class="code-function">KPICollector</span>();
collector.<span class="code-function">run</span>().<span class="code-function">catch</span>(console.error);</pre>
                </div>
            </div>
        </div>

        <!-- Monitoring Section -->
        <div id="monitoring" class="content-section">
            <div class="section">
                <h2>监控告警配置</h2>
                
                <h3>6.1 Prometheus告警规则</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment"># alerts.yml - Prometheus告警规则</span>
<span class="code-keyword">groups</span>:
  - <span class="code-keyword">name</span>: leap_kpi_alerts
    <span class="code-keyword">interval</span>: 30s
    <span class="code-keyword">rules</span>:
      <span class="code-comment"># AI可见度告警</span>
      - <span class="code-keyword">alert</span>: LowAIMentionRate
        <span class="code-keyword">expr</span>: ai_mention_rate < 25
        <span class="code-keyword">for</span>: 30m
        <span class="code-keyword">labels</span>:
          <span class="code-keyword">severity</span>: warning
          <span class="code-keyword">team</span>: content
        <span class="code-keyword">annotations</span>:
          <span class="code-keyword">summary</span>: <span class="code-string">"AI提及率低于预警值"</span>
          <span class="code-keyword">description</span>: <span class="code-string">"当前AI提及率: {{ $value }}%, 低于25%预警线"</span>
      
      - <span class="code-keyword">alert</span>: CriticalAIMentionRate
        <span class="code-keyword">expr</span>: ai_mention_rate < 15
        <span class="code-keyword">for</span>: 15m
        <span class="code-keyword">labels</span>:
          <span class="code-keyword">severity</span>: critical
          <span class="code-keyword">team</span>: content
        <span class="code-keyword">annotations</span>:
          <span class="code-keyword">summary</span>: <span class="code-string">"AI提及率严重偏低！"</span>
          <span class="code-keyword">description</span>: <span class="code-string">"AI提及率仅{{ $value }}%, 需要立即处理"</span>
      
      <span class="code-comment"># 转化率告警</span>
      - <span class="code-keyword">alert</span>: LowOptInRate
        <span class="code-keyword">expr</span>: opt_in_rate < 20
        <span class="code-keyword">for</span>: 1h
        <span class="code-keyword">labels</span>:
          <span class="code-keyword">severity</span>: warning
          <span class="code-keyword">team</span>: growth
        <span class="code-keyword">annotations</span>:
          <span class="code-keyword">summary</span>: <span class="code-string">"线索转化率偏低"</span>
          <span class="code-keyword">description</span>: <span class="code-string">"Opt-in率: {{ $value }}%, 低于20%目标"</span>
      
      <span class="code-comment"># 系统性能告警</span>
      - <span class="code-keyword">alert</span>: HighAPIResponseTime
        <span class="code-keyword">expr</span>: api_response_p95 > 500
        <span class="code-keyword">for</span>: 5m
        <span class="code-keyword">labels</span>:
          <span class="code-keyword">severity</span>: warning
          <span class="code-keyword">team</span>: engineering
        <span class="code-keyword">annotations</span>:
          <span class="code-keyword">summary</span>: <span class="code-string">"API响应时间过高"</span>
          <span class="code-keyword">description</span>: <span class="code-string">"P95响应时间: {{ $value }}ms"</span></pre>
                </div>
                
                <h3>6.2 日志监控配置</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment"># logstash-pipeline.conf</span>
<span class="code-keyword">input</span> {
  <span class="code-keyword">beats</span> {
    <span class="code-keyword">port</span> => 5044
  }
}

<span class="code-keyword">filter</span> {
  <span class="code-comment"># 解析KPI事件</span>
  <span class="code-keyword">if</span> [event_type] == <span class="code-string">"kpi_update"</span> {
    <span class="code-keyword">grok</span> {
      <span class="code-keyword">match</span> => {
        <span class="code-string">"message"</span> => <span class="code-string">"%{TIMESTAMP_ISO8601:timestamp} %{WORD:level} \\[%{DATA:service}\\] KPI: %{WORD:kpi_name}=%{NUMBER:kpi_value:float}"</span>
      }
    }
    
    <span class="code-keyword">mutate</span> {
      <span class="code-keyword">add_field</span> => {
        <span class="code-string">"[@metadata][target_index]"</span> => <span class="code-string">"leap-kpi-%{+YYYY.MM}"</span>
      }
    }
  }
}

<span class="code-keyword">output</span> {
  <span class="code-keyword">elasticsearch</span> {
    <span class="code-keyword">hosts</span> => [<span class="code-string">"localhost:9200"</span>]
    <span class="code-keyword">index</span> => <span class="code-string">"%{[@metadata][target_index]}"</span>
  }
  
  <span class="code-comment"># 关键KPI实时推送</span>
  <span class="code-keyword">if</span> [kpi_name] <span class="code-keyword">in</span> [<span class="code-string">"ai_mention_rate"</span>, <span class="code-string">"opt_in_rate"</span>] {
    <span class="code-keyword">websocket</span> {
      <span class="code-keyword">host</span> => <span class="code-string">"0.0.0.0"</span>
      <span class="code-keyword">port</span> => 3232
    }
  }
}</pre>
                </div>
                
                <h3>6.3 自动化响应脚本</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
<span class="code-comment">// alert-handler.js - 告警自动处理</span>
<span class="code-keyword">const</span> alertHandlers = {
    <span class="code-comment">// AI可见度低 - 自动触发内容优化</span>
    <span class="code-string">'LowAIMentionRate'</span>: <span class="code-keyword">async</span> (alert) => {
        <span class="code-keyword">const</span> actions = [];
        
        <span class="code-comment">// 1. 分析原因</span>
        <span class="code-keyword">const</span> analysis = <span class="code-keyword">await</span> <span class="code-function">analyzeAIVisibility</span>({
            platforms: alert.labels.platforms,
            timeRange: <span class="code-string">'7d'</span>
        });
        
        <span class="code-comment">// 2. 触发内容更新</span>
        <span class="code-keyword">if</span> (analysis.contentAge > <span class="code-number">30</span>) {
            actions.<span class="code-function">push</span>(
                <span class="code-function">triggerContentRefresh</span>({
                    priority: <span class="code-string">'high'</span>,
                    types: [<span class="code-string">'faq'</span>, <span class="code-string">'schema'</span>, <span class="code-string">'video'</span>]
                })
            );
        }
        
        <span class="code-comment">// 3. 调整发布策略</span>
        <span class="code-keyword">if</span> (analysis.publishingGap > <span class="code-number">48</span>) {
            actions.<span class="code-function">push</span>(
                <span class="code-function">adjustPublishingSchedule</span>({
                    frequency: <span class="code-string">'increase'</span>,
                    channels: analysis.weakChannels
                })
            );
        }
        
        <span class="code-comment">// 4. 通知相关团队</span>
        <span class="code-keyword">await</span> <span class="code-function">notifyTeams</span>({
            channels: [<span class="code-string">'slack'</span>, <span class="code-string">'email'</span>],
            teams: [<span class="code-string">'content'</span>, <span class="code-string">'seo'</span>],
            message: <span class="code-function">formatAlertMessage</span>(alert, analysis, actions)
        });
        
        <span class="code-keyword">return</span> { success: <span class="code-keyword">true</span>, actions };
    },
    
    <span class="code-comment">// 转化率低 - 优化着陆页</span>
    <span class="code-string">'LowOptInRate'</span>: <span class="code-keyword">async</span> (alert) => {
        <span class="code-comment">// A/B测试新版本</span>
        <span class="code-keyword">const</span> testConfig = {
            variants: [
                { id: <span class="code-string">'control'</span>, weight: <span class="code-number">0.5</span> },
                { id: <span class="code-string">'new_cta'</span>, weight: <span class="code-number">0.25</span> },
                { id: <span class="code-string">'simplified'</span>, weight: <span class="code-number">0.25</span> }
            ],
            metrics: [<span class="code-string">'opt_in_rate'</span>, <span class="code-string">'bounce_rate'</span>, <span class="code-string">'time_on_page'</span>],
            duration: <span class="code-string">'7d'</span>
        };
        
        <span class="code-keyword">await</span> <span class="code-function">startABTest</span>(testConfig);
        
        <span class="code-keyword">return</span> { 
            success: <span class="code-keyword">true</span>, 
            message: <span class="code-string">'Started A/B test for landing page optimization'</span> 
        };
    }
};

<span class="code-comment">// Webhook接收器</span>
app.<span class="code-function">post</span>(<span class="code-string">'/webhook/alerts'</span>, <span class="code-keyword">async</span> (req, res) => {
    <span class="code-keyword">const</span> alert = req.body;
    
    <span class="code-keyword">if</span> (alertHandlers[alert.alertname]) {
        <span class="code-keyword">const</span> result = <span class="code-keyword">await</span> alertHandlers[alert.alertname](alert);
        res.<span class="code-function">json</span>(result);
    } <span class="code-keyword">else</span> {
        res.<span class="code-function">status</span>(<span class="code-number">404</span>).<span class="code-function">json</span>({ 
            error: <span class="code-string">'No handler for alert type'</span> 
        });
    }
});</pre>
                </div>
                
                <div class="warning-box">
                    <strong>监控最佳实践：</strong>
                    <ul>
                        <li>设置合理的告警阈值，避免告警疲劳</li>
                        <li>使用分级告警（Info → Warning → Critical）</li>
                        <li>配置告警静默期，避免重复通知</li>
                        <li>定期回顾和调整告警规则</li>
                        <li>建立告警处理SOP和值班制度</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
        
        // Copy code functionality
        function copyCode(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.textContent.replace('复制', '').trim();
            
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = '已复制！';
                button.style.background = '#4caf50';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#667eea';
                }, 2000);
            });
        }
        
        // Initialize tooltips
        document.addEventListener('DOMContentLoaded', () => {
            // Add hover effects to KPI cards
            const kpiCards = document.querySelectorAll('.kpi-card');
            kpiCards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-5px)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>